\documentclass[12pt]{article}
\usepackage{enumerate}
\usepackage{graphicx}
\usepackage[utf8]{inputenc}
\usepackage{float}
\usepackage{natbib}
\usepackage{euscript}
\usepackage{color}
\usepackage{amsmath}
\usepackage{epsfig}
\usepackage{amssymb}
\usepackage{graphics}
\usepackage{appendix}
\usepackage[font=footnotesize]{caption}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{hyperref}
\hypersetup{
	colorlinks=true,
	linkcolor=blue,
	filecolor=magenta,      
	urlcolor=blue,
}

\urlstyle{same}
\textheight=8.5in
\textwidth=16cm
\oddsidemargin 0in
\topmargin -0.25in
\setlength{\parindent}{0.5cm}
\begin{document}
\pagestyle{plain}
%\pagestyle{plain}
%\vspace {2in}
%\vspace{0.4cm}

%\title{ \bf TITLE}
%\author{Nathan Sanford\\}
%\date{\today}  %\today is replaced with the current date
%\maketitle
%\vspace{-.7cm}

%\raggedright

{\centering \Large Nathan Sanford\\
Earthquake Inference Project\\}
\vspace{0.5cm}

This short project infers the hypocenter of an earthquake from seismic data using least-squares multilateration.
The seismic data consists of arrival times (relative to a common time) of an earthquake's seismic \textit{P}-waves\footnote{More on \textit{P}-waves can be found \href{https://en.wikipedia.org/wiki/P-wave}{here}.} at a portion of the stations that make up \href{http://www.usarray.org}{Earthscopeâ€™s USArray}.

Let the velocity of the \textit{P}-waves associated with the earthquake travel with a velocity of $\alpha$km/s. We can then use the arrival times at each seismic observation station and the locations of each station to set up a system of equations which the hypocenter and origination time of the earthquake obey. Let $t_i, x_i, y_i, \text{and } z_i$ be the arrival time and location of the $\text{i}^{\text{th}}$ station and $t_e, x_e, y_e, \text{and } z_e$ be the origination time and hypocenter location of the earthquake. Then we have 
\begin{equation}
\label{fulldist}
t_i-t_e=\frac{1}{\alpha}D_i(x_e,y_e,z_e)
\end{equation}
where $D_i(x_e,y_e,z_e)=\sqrt{(x_i-x_e)^2+(y_i-y_e)^2+(z_i-z_e)^2}$. This equation simply comes from distance equals rate multiplied by time. 

We can see that retrieving the hypocenter from the arrival times is a nonlinear inverse problem as \eqref{fulldist} is nonlinear in $x_e, y_e, \text{and } z_e$. We then make a number of simplifying assumptions in order to make this problem more tractable.
First, we will assume that the depth of the hypocenter is $z_e=10$ km below sea level and that the \textit{P}-wave velocity is a constant $\alpha=5.7$km/s\footnote{These simplifying assumptions were made solely so that the problem could be done quickly in the context of the class.}. Then we will linearize the problem by making an initial guess for the origin time and epicenter coordinates of the earthquake  $t^o_e, x^o_e, y^o_e$ and expand around this guess so that $t_e=t^o_e+dt, x_e=x^o_e+dx,$ and $y_e=y^o_e+dy$. Then, the distance between the earthquake and the $\text{i}^{\text{th}}$ station becomes approximately
\begin{equation}
\label{dist_expansion}
D_i(x_e,y_e)\approx D_i(x^o_e,y^o_e)+\frac{1}{D_i(x^o_e,y^o_e)}[(x^o_e-x_i)dx+(y^o_e-y_i)dy]
\end{equation}
where $D_i(x^o_e,y^o_e)=\sqrt{(x_i-x^o_e)^2+(y_i-y^o_e)^2+(z_i+10)^2}$. Then, the full nonlinear problem \eqref{fulldist} can be approximated by
\begin{equation}
\label{lindist}
t_i-t^o_e=dt+\frac{1}{\alpha}\{D_i(x^o_e,y^o_e)+\frac{1}{D_i(x^o_e,y^o_e)}[(x^o_e-x_i)dx+(y^o_e-y_i)dy]\}.
\end{equation}
This simplified linear problem with three unknowns ($dx, dy, dt$) is the problem we will solve.

As this problem is linear, it can be written as a matrix vector equation. To do this, we isolate the data that is known \textit{a priori} (upon a choice for the initial guess) and define
\begin{equation}
\label{data}
d_i=t_i-t^o_e-\frac{1}{\alpha}D_i(x^o_e,y^o_e).
\end{equation}
Now, substituting \eqref{data} into \eqref{lindist} we get a problem for the unknown model vector $\underline{m}=(dt,dx,dy)^T$ that looks like
\begin{equation}
\label{matrix_problem}
\underline{d}=\underline{\underline{G}}\,\underline{m}
\end{equation}
where the $\text{i}^{\text{th}}$ row of the design matrix $\underline{\underline{G}}$ is given by 
$$\Big{(}1, \frac{x^o_e-x_i}{\alpha D_i(x^o_e,y^o_e)},\frac{y^o_e-y_i}{\alpha D_i(x^o_e,y^o_e)}\Big{)}.$$

%\item The table of observation data listed in the assignment was coded into Python. It will not be reproduced here for brevity's sake. However, I will note that since there are 12 observations, the design matrix $\underline{\underline{G}}$ is therefore a $12\times3$ matrix. The locations of the observation stations can then be visualized using the Python map-making utility basemap (see figure \ref{map}).
%%\begin{figure}[h]
%%\center
%%\includegraphics[width=15cm]{map.png}
%%\caption{Map of seismic observation stations (purple) included in the data. The green point is a characteristic initial guess for the epicenter of the earthquake. The initial guess for the origin time for this guess is $14.945$ s (relative to 14:16).}
%%\label{map}
%%\end{figure}
%
The locations of the observation stations were naturally given in terms of their latitudes and longitudes. However, this is not optimal since the distances in \eqref{linear_problem} are assumed to be in kilometers. Therefore, we roughly convert between degrees latitude and longitude using approximate conversion factors of $1^{\circ}$ latitude being $111.19$ km and $1^{\circ}$ longitude being $85.18$ km. These conversion factors are only appropriate for the general region encompassing the southeastern United States, so the latitudes and longitudes were first centered on a reference point near the Nevada-Utah border. After making a random initial guess for the epicenter, the initial guess for the origin time was computed by calculating the distance to the nearest station and using its \textit{P}-wave arrival time.
%
%\item The distance vector, data vector, and design matrix are computed in my code.
%
The generalized inverse 
$$\underline{\underline{G}}^{-g}=(\underline{\underline{G}}^T\underline{\underline{G}})^{-1}\underline{\underline{G}}^T$$
was used to compute the least-squares solution to \eqref{matrix_problem} which is
\begin{equation}
\label{least_squares}
\underline{m}=\underline{\underline{G}}^{-g}\,\underline{d}.
\end{equation}
A solution model vector $\underline{m}=(dt,dx,dy)$ from \eqref{least_squares} then gives an updated guess for the epicenter $(x^o_e+dx,y^o_e+dy)$ and origin time $t^o_e+dt$ of the earthquake. This then provides the basis for an iterative method where the hypocenter is updated by least-squares-computed corrections. 
%%\begin{figure}[h]
%%\center
%%\includegraphics[width=15cm]{map_1.png}
%%\caption{Map showing the least squares solution for the earthquake epicenter (blue) for a particular initial guess (green). The initial guess for the origin time for this guess is $14.945$s (relative to 14:16). The caption for the blue point is the least squares solution for the origin time of the earthquake.}
%%\label{map_1}
%%\end{figure}
%
%\item Redefining the initial guess to be the least squares solution seen in figure \eqref{map_1} allows for more iterations of least squares to be performed. The second iteration from the initial guess seen in figure \eqref{map} can be seen in figure \ref{map_2}.
%%\begin{figure}[h]
%%\center
%%\includegraphics[width=15cm]{map_2.png}
%%\caption{Map showing the least squares solution for the earthquake epicenter computed after two iterations (blue) for a particular initial guess (green), and an intermediate solution obtained by one iteration of least squares (red). The initial guess for the origin time for this guess is $14.945$s (relative to 14:16). The caption for the blue point is the least squares solution for the origin time of the earthquake.}
%%\label{map_2}
%%\end{figure}
%This iterative process was repeated until successive iterations produced roughly the same answer. The convergence criterion used was the relative difference between successive iterations being less than a prescribed tolerance
%$$\text{max}(\underline{m}_{n+1}-\underline{m}_n)<\text{tol}.$$
%The results of this iterative process are shown in figure \ref{map_final} where the tolerance used was 0.1. This choice of convergence criterion was used as it was fairly intuitive in terms of guaranteeing the numerical error in the epicenter (in km) and origin time (in s) to be on the approximate order of the tolerance. Additionally, it showed itself to be robust as various initial guesses all converged rather quickly in a handful of iterations to the same location and time shown in figure \ref{map_final}.
%%\begin{figure}[h]
%%\center
%%\includegraphics[width=15cm]{map_final.png}
%%\caption{Map showing the least squares solution for the earthquake epicenter in blue arising from a particular initial guess (green) with intermediate iterations shown in red. The initial guess for the origin time for this guess is $14.945$s (relative to 14:16). The caption for the blue point is the least squares solution for the origin time of the earthquake. The coordinates of the epicenter solution were $-114.883^{\circ}$ longitude and $41.084^{\circ}$ latitude.}
%%\label{map_final}
%%\end{figure}
%
%\item After a least squares solution converged, the covariance matrix for the model vector $\underline{m}$ was computed in order to assess the uncertainty in the solution that comes from the uncertainty in the data. The covariance matrix is given by
%$$\text{cov}(\underline{m})=\sigma^2(\underline{\underline{G}}^T\underline{\underline{G}})^{-1}$$ 
%where $\sigma^2=0.64$ is the variance in the data given in the assignment. The covariance matrix for the final solution in figure \ref{map_final} was 
%$$\text{cov}(\underline{m})\approx
%\begin{pmatrix} 
%0.05 & 0.05 & -0.07\\
%0.05 & 8.50 & -6.06 \\
%-0.07 & -6.06 & 7.62
%\end{pmatrix}.$$
%The first element is the variance of dt so it implies that the standard deviation of the origin time was about 0.233. The $2\times2$ lower right sub-block can then allow us to draw an error ellipse for the epicenter. By decomposing this matrix into it's eigenvalues $\lambda_i$ and eigenvectors $\underline{v}_i$ for i=1,2, we can see that the error ellipse for this solution has radii of length $\sqrt{\lambda_i}$ in the direction of $\underline{v}_i$. In this case we have $\lambda_1=14.13, \lambda_2=1.99,$ 
%$$\underline{v}_1=\begin{pmatrix} 
%0.73 \\
%-0.68
%\end{pmatrix}, \quad \text{and} \quad \underline{v}_2=\begin{pmatrix} 
%0.68 \\
%0.73
%\end{pmatrix}.$$
%This then implies that the error ellipse has the equation 
%$$\frac{((x-x_c) \sin \alpha-(y-y_c) \cos \alpha)^2}{\lambda_1}+\frac{((x-x_c) \cos \alpha+(y-y_c) \sin \alpha)^2}{\lambda_2}=1$$
%where $\alpha=\text{arctan}\frac{0.73}{0.68}=0.82$ controls the orientation of the ellipse so that its radii. This ellipse is in units of km and its center $(x_c,y_c)$ is the center of the ellipse in km east/west and north/south of the coordinate origin shown in figure \eqref{map}. It was too cumbersome to plot the ellipse in basemap so I simply chose to describe it mathematically. Its form indicates that there is much more uncertainty for this guess in the northwest/southeast direction than in the southwest/northeast direction, which are roughly the radial directions of this error ellipse. Since the radii of the error elipse are both less than 10 km and the epicenter is approximately 60 km from the Nevada border, we can be rather confident that the earthquake epicenter is in Nevada. 
%\end{enumerate}
\end{document}
